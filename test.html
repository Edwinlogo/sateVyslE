<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Elsy Ventas</title>

  <!-- Librería para leer archivos CSV desde Google Sheets -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

  <style>
    /* ========= CURSOR PERSONALIZADO ========= */
    :root{
      --cursor-size: 32px;
      --cursor-hotspot-x: 14px;
      --cursor-hotspot-y: 9px;
      --cursor-image: url('https://www.freeiconspng.com/uploads/description-cursor-icon-with-shadow-32.png');
      --whatsapp-number: '573001234567'; /* Cambia este número por el tuyo */
    }
    .custom-cursor{
      position: fixed;
      left: 0; top: 0;
      width: var(--cursor-size);
      height: var(--cursor-size);
      background-image: var(--cursor-image);
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      pointer-events: none;
      z-index: 3000;
      transform: translate(calc(-1 * var(--cursor-hotspot-x)), calc(-1 * var(--cursor-hotspot-y)));
    }

    /* ======== BARRA DE ENCABEZADO FIJA ======== */
    .top-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(15px);
      color: white;
      padding: 15px 0;
      z-index: 2000;
      font-size: 0.9rem;
      border-bottom: 1px solid rgba(255, 140, 0, 0.3);
    }
    .top-bar-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* Fila superior con información de contacto */
    .contact-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }
    .contact-left {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    .contact-right {
      display: flex;
      flex-direction: column;
      gap: 3px;
      text-align: right;
    }
    .contact-info {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.85rem;
    }
    .contact-info a {
      color: #FF8C00;
      text-decoration: none;
    }
    .contact-info a:hover {
      text-decoration: underline;
    }
    
    /* Título principal en el header */
    .header-title {
      text-align: center;
      margin-bottom: 15px;
    }
    .header-title h1 {
      font-size: 2.2rem;
      margin: 0 0 5px 0;
      color: #FF8C00;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    .header-title p {
      font-size: 1rem;
      margin: 0;
      color: rgba(255,255,255,0.9);
    }
    
    /* Barra de búsqueda en el header */
    .header-search {
      display: flex;
      justify-content: center;
      margin-bottom: 15px;
    }
    .header-search input {
      width: 100%;
      max-width: 500px;
      padding: 12px 18px;
      border-radius: 25px;
      border: none;
      outline: none;
      font-size: 1rem;
      background: rgba(255,255,255,0.95);
      cursor: text;
    }
    .header-search input::placeholder {
      color: #666;
    }
    
    /* Categorías en el header */
    .header-categories {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }

    /* ======== ESTILOS GENERALES (ajustados para la barra fija) ======== */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #FF8C00 0%, #000000 100%);
      min-height: 100vh;
      margin: 0;
      padding: 200px 20px 20px; /* Padding superior aumentado para la barra fija más grande */
      color: #333;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      cursor: none;
    }

    input, textarea, [contenteditable="true"], [contenteditable=true]{
      -webkit-user-select: text !important;
      -moz-user-select: text !important;
      -ms-user-select: text !important;
      user-select: text !important;
      -webkit-touch-callout: default !important;
    }

    .container { max-width: 1200px; margin: 0 auto; }

    /* Encabezado principal (ahora vacío o reducido) */
    .header { 
      display: none; /* Ocultar ya que todo está en el top-bar */
    }

    /* ======== BARRA DE BÚSQUEDA ======== */
    .search-bar { 
      display: none; /* Ya está en el header */
    }

    /* ======== BOTONES DE CATEGORÍA ======== */
    .categories { 
      display: none; /* Ya están en el header */
    }
    .category-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 20px;
      background: rgba(255,255,255,0.9);
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .category-btn:hover, .category-btn.active {
      background: linear-gradient(135deg,#FF8C00 0%,#000000 100%);
      color: white;
    }

    /* ======== TARJETAS DE PRODUCTOS ======== */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px,1fr));
      gap: 20px;
    }
    .product-card {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 6px 15px rgba(0,0,0,0.15);
      transition: transform 0.2s;
    }
    .product-card:hover { transform: translateY(-5px); }
    .product-image { width: 100%; height: 200px; object-fit: cover; }
    .product-info { padding: 15px; }
    .product-name { font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; }
    .product-price { font-size: 1.2rem; color: #FF8C00; font-weight: bold; margin-bottom: 5px; }
    .product-category {
      font-size: 0.9rem;
      background: #eee;
      padding: 2px 10px;
      border-radius: 10px;
      display: inline-block;
    }
    .product-stock {
      font-size: 0.85rem;
      color: #666;
      margin-top: 5px;
    }
    .stock-available { color: #28a745; font-weight: bold; }
    .stock-low { color: #ffc107; font-weight: bold; }
    .stock-out { color: #dc3545; font-weight: bold; }

    /* ======== BOTÓN "CARGAR MÁS" ======== */
    .load-more {
      display: block;
      margin: 30px auto;
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      background: white;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .load-more:hover {
      background: linear-gradient(135deg,#FF8C00 0%,#000000 100%);
      color: white;
    }

    /* ======== MODAL ======== */
    .modal {
      display: none;
      position: fixed;
      z-index: 1500;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center; align-items: center;
      padding: 15px;
    }
    .modal-content {
      background: white;
      border-radius: 15px;
      max-width: 850px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    .modal-header {
      padding: 20px;
      background: linear-gradient(135deg,#FF8C00,#000000);
      color: white;
      border-radius: 15px 15px 0 0;
      position: relative;
    }
    .close { position: absolute; right: 20px; top: 20px; font-size: 28px; }
    .modal-body { padding: 20px; }

    /* ======== CARRUSEL DE IMÁGENES ======== */
    .carousel { position: relative; margin-bottom: 20px; text-align: center; }
    .carousel img {
      max-width: 100%; max-height: 350px;
      object-fit: contain;
      border-radius: 10px;
    }
    .carousel-btn {
      position: absolute;
      top: 50%; transform: translateY(-50%);
      background: rgba(0,0,0,0.5);
      color: white;
      border: none;
      font-size: 22px;
      padding: 10px;
      border-radius: 50%;
    }
    .carousel-btn.left { left: 15px; }
    .carousel-btn.right { right: 15px; }

    .modal-price { font-size: 1.5rem; color: #FF8C00; font-weight: bold; margin-bottom: 12px; }
    .modal-stock { font-size: 1.1rem; margin-bottom: 15px; }

    /* ======== BOTONES DE ACCIÓN MEJORADOS ======== */
    .action-buttons { 
      display: flex; 
      gap: 15px; 
      margin-top: 20px; 
      flex-wrap: wrap; 
    }
    .action-btn {
      flex: 1;
      min-width: 150px;
      background: linear-gradient(135deg,#FF8C00,#000000);
      color: white; 
      border: none;
      padding: 12px 20px; 
      border-radius: 25px;
      font-weight: bold;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.3s ease;
    }
    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .whatsapp-btn {
      background: linear-gradient(135deg, #25D366, #128C7E);
    }
    .whatsapp-btn:hover {
      background: linear-gradient(135deg, #128C7E, #25D366);
    }

    /* ======== LIGHTBOX ======== */
    .lightbox {
      display: none;
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.95);
      justify-content: center; align-items: center;
      z-index: 2500;
    }
    .lightbox img {
      max-width: 90%; max-height: 90%;
      object-fit: contain;
    }
    .lightbox-close {
      position: absolute; top: 20px; right: 30px;
      font-size: 35px;
      color: white;
      font-weight: bold;
    }

    /* ======== RESPONSIVE ======== */
    @media (max-width: 768px) {
      .contact-row {
        flex-direction: column;
        text-align: center;
        gap: 8px;
        margin-bottom: 12px;
      }
      .contact-left, .contact-right {
        text-align: center;
      }
      .contact-info {
        justify-content: center;
      }
      .header-title h1 {
        font-size: 1.8rem;
      }
      .header-categories {
        gap: 8px;
      }
      .category-btn {
        padding: 8px 16px;
        font-size: 0.9rem;
      }
      body {
        padding-top: 280px;
      }
      .action-buttons {
        flex-direction: column;
      }
      .action-btn {
        min-width: 100%;
      }
    }
    @media (max-width: 600px) {
      .product-image { height: 160px; }
      .modal-content { width: 95%; }
      .carousel img { max-height: 250px; }
      .product-name { font-size: 1rem; }
      .product-price { font-size: 1.1rem; }
      .header-title h1 {
        font-size: 1.6rem;
      }
      body {
        padding-top: 320px;
      }
    }
  </style>
</head>
<body>
  <!-- ======== BARRA DE ENCABEZADO FIJA ======== -->
  <div class="top-bar">
    <div class="top-bar-content">
      <!-- Información de contacto superior -->
      <div class="contact-row">
        <div class="contact-left">
          <div class="contact-info">
            <span>📧</span>
            <a href="mailto:contacto@elsyventas.com">contacto@elsyventas.com</a>
          </div>
          <div class="contact-info">
            <span>📍</span>
            <span>Carrera 5 #12-34, Ibagué, Tolima</span>
          </div>
        </div>
        <div class="contact-right">
          <div class="contact-info">
            <span>📱</span>
            <a href="https://wa.me/573001234567">WhatsApp: +57 300 123 4567</a>
          </div>
          <div class="contact-info">
            <span>🕒</span>
            <span>Lunes a Sábado: 8:00 AM - 6:00 PM</span>
          </div>
        </div>
      </div>
      
      <!-- Título principal -->
      <div class="header-title">
        <h1>🛍️ Elsy Ventas 🐦‍🔥</h1>
        <p>Descubre nuestros increíbles productos</p>
      </div>
      
      <!-- Barra de búsqueda -->
      <div class="header-search">
        <input type="text" id="searchInput" placeholder="Buscar productos...">
      </div>
      
      <!-- Botones de categorías -->
      <div id="categories" class="header-categories"></div>
    </div>
  </div>

  <!-- Cursor personalizado -->
  <div class="custom-cursor" id="customCursor" aria-hidden="true"></div>

  <div class="container">
    <!-- Grid de productos -->
    <div id="productsGrid" class="products-grid"></div>

    <!-- Botón para cargar más productos -->
    <button id="loadMoreBtn" class="load-more">Cargar más</button>
  </div>

  <!-- ======== MODAL DETALLE PRODUCTO ======== -->
  <div id="productModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span id="modalTitle"></span>
        <span class="close" onclick="closeModal()">&times;</span>
      </div>
      <div class="modal-body">
        <!-- 🖼️ Carrusel imágenes -->
        <div class="carousel">
          <button class="carousel-btn left" onclick="prevImage()">&#10094;</button>
          <img id="carouselImage" src="" alt="Imagen producto" onclick="openLightbox()">
          <button class="carousel-btn right" onclick="nextImage()">&#10095;</button>
        </div>
        <div id="modalPrice" class="modal-price"></div>
        <div id="modalStock" class="modal-stock"></div>
        <div id="modalDescription"></div>
        
        <!-- Botones de acción -->
        <div class="action-buttons">
          <button id="shareBtn" class="action-btn">
            <span>🔗</span>
            <span>Compartir</span>
          </button>
          <button id="whatsappBtn" class="action-btn whatsapp-btn">
            <span>💬</span>
            <span>Pedir por WhatsApp</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ======== LIGHTBOX (imagen fullscreen) ======== -->
  <div id="lightbox" class="lightbox" onclick="closeLightbox()">
    <span class="lightbox-close">&times;</span>
    <img id="lightboxImage" src="">
  </div>

  <!-- ======== JAVASCRIPT ======== -->
  <script>
    /* ========== CONFIGURACIÓN ========== */
    const WHATSAPP_NUMBER = '573001234567'; // Cambia por tu número de WhatsApp

    /* ========== BLOQUEOS DE SEGURIDAD ========== */
    document.addEventListener("contextmenu", e => e.preventDefault());
    document.addEventListener("dragstart", e => e.preventDefault());
    document.addEventListener("copy", e => {
      const t = e.target;
      if (t && (t.tagName === 'INPUT' || t.tagName === 'TEXTAREA' || t.isContentEditable)) return;
      e.preventDefault();
    });

    /* ========== CURSOR PERSONALIZADO ========== */
    (function(){
      const cur = document.getElementById('customCursor');
      let visible = false;
      document.addEventListener('mousemove', (e)=>{
        if(!visible){ cur.style.display = 'block'; visible = true; }
        cur.style.left = e.clientX + 'px';
        cur.style.top  = e.clientY + 'px';
      });
      document.addEventListener('mouseleave', ()=>{ cur.style.display = 'none'; visible = false; });
    })();

    /* ========== FUNCIONES DE COMPARTIR NATIVAS ========== */
    async function shareProduct(productName, productUrl) {
      // Verificar si el dispositivo soporta Web Share API
      if (navigator.share) {
        try {
          await navigator.share({
            title: `${productName} - Elsy Ventas`,
            text: `Mira este producto: ${productName}`,
            url: productUrl
          });
          return true;
        } catch (err) {
          console.log('Error al compartir:', err);
          return false;
        }
      }
      return false;
    }

    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (err) {
        // Fallback para navegadores más antiguos
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed";
        textArea.style.left = "-999999px";
        textArea.style.top = "-999999px";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        let success = false;
        try {
          success = document.execCommand('copy');
        } catch (err) {
          console.log('Fallback copy failed:', err);
        }
        document.body.removeChild(textArea);
        return success;
      }
    }

    /* =================== CATÁLOGO =================== */
    let products = [];
    let currentProduct = null;
    let currentImages = [];
    let currentIndex = 0;
    let visibleCount = 12;
    const perPage = 12;
    let currentCategory = "todos";

    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRMHSCo3Fnmvpys4u0f2ryi59rBd5_jpHjSoyqXfyBNuL8bOXjvKzx1ns2mxZN2akZ7h9DWOUhymCsj/pub?gid=0&single=true&output=csv";

    function formatStock(stock) {
      const stockNum = parseInt(stock) || 0;
      if (stockNum <= 0) {
        return '<span class="stock-out">Sin stock</span>';
      } else if (stockNum <= 5) {
        return `<span class="stock-low">Quedan ${stockNum} unidades</span>`;
      } else {
        return `<span class="stock-available">Stock disponible (${stockNum})</span>`;
      }
    }

    /* Carga de datos */
    fetch(sheetUrl)
      .then(res => res.text())
      .then(csv => {
        Papa.parse(csv, {
          header: true,
          skipEmptyLines: true,
          complete: function(results) {
            products = results.data.filter(p => 
              p.Producto && 
              p['Precio Público'] && 
              (p.Categoría || p['Categoría 2'])
            );
            createCategoryButtons();
            displayProducts();
            loadFromUrl();
          }
        });
      });

    function createCategoryButtons() {
      const cats = [...new Set([
        ...products.map(p => p.Categoría).filter(Boolean),
        ...products.map(p => p['Categoría 2']).filter(Boolean)
      ])];
      
      const categoriesDiv = document.getElementById("categories");
      categoriesDiv.innerHTML = `<button class="category-btn active" onclick="filterProducts('todos', this)">Todos</button>`;
      cats.forEach(cat => {
        categoriesDiv.innerHTML += `<button class="category-btn" onclick="filterProducts('${cat}', this)">${cat}</button>`;
      });
    }

    function filterProducts(cat, btn) {
      document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentCategory = cat;
      visibleCount = perPage;
      displayProducts(cat);
    }

    function displayProducts(cat="todos") {
      const grid = document.getElementById("productsGrid");
      const searchText = document.getElementById("searchInput").value.toLowerCase();

      let filtered = products.filter(p => {
        const matchCategory = cat === "todos" || 
                            p.Categoría === cat || 
                            p['Categoría 2'] === cat;
        const matchSearch = p.Producto.toLowerCase().includes(searchText) || 
                          (p.Descripcion || "").toLowerCase().includes(searchText);
        return matchCategory && matchSearch;
      });

      let toShow = filtered.slice(0, visibleCount);

      if (toShow.length === 0) {
        grid.innerHTML = "<p style='color:white;'>No hay coincidencias con tu búsqueda</p>";
        document.getElementById("loadMoreBtn").style.display = "none";
        return;
      }

      grid.innerHTML = toShow.map(p => {
        const price = parseFloat(p['Precio Público']) || 0;
        const mainCategory = p.Categoría || p['Categoría 2'] || 'Sin categoría';
        const stock = parseInt(p.Stock) || 0;
        
        return `
          <div class="product-card" onclick="openModal('${p.Producto}')">
            <img class="product-image" src="${p.img01 || 'https://via.placeholder.com/250x200?text=Sin+Imagen'}" alt="${p.Producto}">
            <div class="product-info">
              <div class="product-name">${p.Producto}</div>
              <div class="product-price">$${price.toLocaleString('es-CO')}</div>
              <div class="product-category">${mainCategory}</div>
              <div class="product-stock">${formatStock(stock)}</div>
            </div>
          </div>
        `;
      }).join('');

      document.getElementById("loadMoreBtn").style.display = filtered.length > visibleCount ? "block" : "none";
    }

    document.getElementById("loadMoreBtn").onclick = function() {
      visibleCount += perPage;
      displayProducts(currentCategory);
    };

    document.getElementById("searchInput").addEventListener("input", () => {
      visibleCount = perPage;
      displayProducts(currentCategory);
    });

    function openModal(name) {
      const product = products.find(p => p.Producto === name);
      if (!product) return;
      currentProduct = product;

      document.getElementById("modalTitle").textContent = product.Producto;
      
      const price = parseFloat(product['Precio Público']) || 0;
      document.getElementById("modalPrice").textContent = "$" + price.toLocaleString('es-CO');
      
      document.getElementById("modalStock").innerHTML = formatStock(product.Stock);
      document.getElementById("modalDescription").textContent = product.Descripcion || "Sin descripción disponible";

      currentImages = [
        product.img01, 
        product.img02, 
        product.img03, 
        product.img04, 
        product.img05
      ].filter(Boolean);
      
      currentIndex = 0;
      updateCarousel();

      document.getElementById("productModal").style.display = "flex";
      document.body.style.overflow = "hidden";
    }

    function closeModal() {
      document.getElementById("productModal").style.display = "none";
      currentProduct = null;
      document.body.style.overflow = "auto";
    }

    function updateCarousel() {
      if (currentImages.length > 0) {
        document.getElementById("carouselImage").src = currentImages[currentIndex];
      } else {
        document.getElementById("carouselImage").src = "https://via.placeholder.com/400x200?text=Sin+Imagen";
      }
    }

    function prevImage() {
      if (currentImages.length > 0) {
        currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
        updateCarousel();
      }
    }

    function nextImage() {
      if (currentImages.length > 0) {
        currentIndex = (currentIndex + 1) % currentImages.length;
        updateCarousel();
      }
    }

    function openLightbox() {
      document.getElementById("lightboxImage").src = currentImages[currentIndex];
      document.getElementById("lightbox").style.display = "flex";
    }

    function closeLightbox() {
      document.getElementById("lightbox").style.display = "none";
    }

    /* ========== FUNCIONES DE COMPARTIR Y WHATSAPP ========== */
    document.getElementById("shareBtn").onclick = async function() {
      if (!currentProduct) return;
      
      const base = window.location.origin + window.location.pathname;
      const productUrl = base + "?producto=" + encodeURIComponent(currentProduct.Producto);
      
      // Cambiar texto del botón temporalmente
      const originalText = this.innerHTML;
      this.innerHTML = '<span>⏳</span><span>Compartiendo...</span>';
      
      // Intentar usar la API nativa de compartir primero
      const shared = await shareProduct(currentProduct.Producto, productUrl);
      
      if (!shared) {
        // Si no se pudo compartir nativamente, copiar al portapapeles
        const copied = await copyToClipboard(productUrl);
        if (copied) {
          this.innerHTML = '<span>✅</span><span>¡Copiado!</span>';
        } else {
          this.innerHTML = '<span>❌</span><span>Error</span>';
        }
      } else {
        this.innerHTML = '<span>✅</span><span>¡Compartido!</span>';
      }
      
      // Restaurar texto original después de 2 segundos
      setTimeout(() => {
        this.innerHTML = originalText;
      }, 2000);
    };

    document.getElementById("whatsappBtn").onclick = function() {
	
	document.getElementById("whatsappBtn").onclick = function() {
     if (!currentProduct) return;
     
     const base = window.location.origin + window.location.pathname;
     const productUrl = base + "?producto=" + encodeURIComponent(currentProduct.Producto);
     const price = parseFloat(currentProduct['Precio Público']) || 0;
     
     const message = `¡Hola! Me interesa este producto:

🛍️ *${currentProduct.Producto}*
💰 Precio: $${price.toLocaleString('es-CO')}
${currentProduct.Descripcion ? `📝 ${currentProduct.Descripcion}` : ''}

🔗 Ver producto: ${productUrl}

¿Podrías darme más información?`;

     const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
     window.open(whatsappUrl, '_blank');
   };

   function loadFromUrl() {
     const params = new URLSearchParams(window.location.search);
     const prod = params.get("producto");
     if (prod) openModal(decodeURIComponent(prod));
   }

   window.onclick = function(e) {
     if (e.target.id === "productModal") closeModal();
     if (e.target.id === "lightbox") closeLightbox();
   };
 </script>
</body>
</html>
